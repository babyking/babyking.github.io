<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
  
	<title> karabiner的alone,held_down,delayed_action这几个事件</title>
  

	<link rel="stylesheet" type="text/css" href="/css/style.css" />
	<link rel="stylesheet" type="text/css" href="/css/syntax.css" />
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/lzyy">
</head>


<body>
	<div id="nav">
	<div class="wrapper">
		<div id="logo"><a href="/"><img src="/image/logo.png" /></a></h1>
		</div>
		<ul>
			<li id="1"><a href="/">首页</a></li>
			<li id="2"><a href="/tech/">技术</a></li>
			<li id="3"><a href="/music/">音乐</a></li>
			<li id="4"><a href="/sketch/">随笔</a></li>
			<li id="5"><a href="/find/">发现</a></li>
			<li id="6"><a href="/about/">关于</a></li>
		</ul>
	</div>
</div>

<script>
	var category = location.pathname;
	if (category == '/') {
		document.getElementById('1').style.textDecoration = "underline";
	} else if (category == '/tech/') {
		document.getElementById('2').style.textDecoration = "underline";
	} else if (category == '/music/') {
		document.getElementById('3').style.textDecoration = "underline";
	} else if (category == '/sketch/') {
		document.getElementById('4').style.textDecoration = "underline";
	} else if (category == '/find/') {
		document.getElementById('5').style.textDecoration = "underline";
	} else if (category == '/about/') {
		document.getElementById('6').style.textDecoration = "underline";
	} 

</script>
	<div class="wrapper main padding-top50">
		<div id="content">
			<h1>karabiner的alone,held_down,delayed_action这几个事件</h1>
			<span class="sub_date">July 18, 2019</span>
			<div class="cnt">
				<p>在折腾karabiner的时候, <code class="highlighter-rouge">to_if_alone</code> <code class="highlighter-rouge">to_if_held_down</code> <code class="highlighter-rouge">to_delayed_action</code> 这几个事件之间的关系很不容易理解,特别是这几个需要配合的时候.</p>

<p>尝试做个试验理解一下.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"manipulators"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"basic.to_delayed_action_delay_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
        </span><span class="nl">"basic.to_if_alone_timeout_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="nl">"basic.to_if_held_down_threshold_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"modifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"any"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"to_delayed_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"to_if_canceled"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"to_if_invoked"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"i"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"to_if_alone"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"halt"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"to_if_held_down"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"h"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"repeat"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basic"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>上面的配置参数经过多次实验,终于明白这几个事件的机制了.</p>

<p>首先了解这3个参数的功能:</p>

<p>“parameters”: {</p>

  			“basic.to_delayed_action_delay_milliseconds”: 300, <br />

<p>​        	   <strong>// 按下一个键超过300毫秒触发 to_delayed_action事件,如果在300毫秒之内,有另外一个键的事件发性,则会触发其下的 to_if_canceled 事件,同时后面不会处理与to_if_canceled同级的to_if_invoked事件.</strong></p>

  			“basic.to_if_alone_timeout_milliseconds”: 200,  <br />

  			<strong>// 按下一个键并释放的时间不超过200毫秒触发 to_if_alone 事件</strong>

  			“basic.to_if_held_down_threshold_milliseconds”: 200  <br />

  			<strong>//按下一个键超过200毫秒</strong>       <br />

<p>}</p>

<p>这几个事件独立使用很简单,但是经过组合可以实现很酷的键盘定义.</p>

<p>比如,需要对F键做如下功能实现:</p>

<ol>
  <li>正常的单击输出t</li>
  <li>长按F输出⌘</li>
</ol>

<p>我们不加思索,就可以写个配置</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"manipulators"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"modifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"any"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"to"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">      
      </span><span class="nl">"to_if_held_down"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"left_command"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"repeat"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basic"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>但是上面的配置可以运行,但是会有2个问题</p>

<ol>
  <li>
    <p>当单击t时,key_down与key_up事件间的时间处于<code class="highlighter-rouge">basic.to_if_alone_timeout_milliseconds</code>定义的临界点时,会顺序输出left_command和t,当然对于这个场景独立的输出command没有功能影响,但如果是其他功能组合键就会有问题了.</p>
  </li>
  <li>
    <p>当打字速度快的时候,当<code class="highlighter-rouge">t</code>的key_up事件还没发生的时候,另外一个键的key_down发生时,t的这个输入就会丢失.</p>
  </li>
</ol>

<p><img src="/image/Snip20190718_2.png" alt="Snip20190718_2" /></p>

<p>所以karabiner给出了 to_delayed_action &gt; to_if_canceld 这样的事件有于补偿修正事件处于临界点的异常情况.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"manipulators"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"basic.to_delayed_action_delay_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
        </span><span class="nl">"basic.to_if_alone_timeout_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="nl">"basic.to_if_held_down_threshold_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"modifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="s2">"any"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"to_delayed_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">//超过</span><span class="mi">300</span><span class="err">毫秒触发此事件块中所定义的事件</span><span class="w">
        </span><span class="nl">"to_if_canceled"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span><span class="err">//在</span><span class="mi">300</span><span class="err">毫秒内如果有其他键的事件发生</span><span class="p">,</span><span class="err">则触发此事件</span><span class="p">,</span><span class="err">此事件中的key_code定义为原始key</span><span class="p">,</span><span class="err">作为补偿修正</span><span class="p">,</span><span class="err">同时</span><span class="w"> </span><span class="err">to_if_invoked的事件不会再触发</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
        </span><span class="err">//</span><span class="p">,</span><span class="nl">"to_if_invoked"</span><span class="p">:[</span><span class="w">  </span><span class="err">//如果to_if_canceled</span><span class="w"> </span><span class="err">未被触发</span><span class="p">,</span><span class="err">超出</span><span class="mi">300</span><span class="err">毫秒后刚触发此事件.</span><span class="w">
        </span><span class="err">//</span><span class="w">  </span><span class="p">{}</span><span class="w">
        </span><span class="err">//</span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"to_if_alone"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"halt"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"to_if_held_down"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"key_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"left_command"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"repeat"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basic"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>完美!</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"basic.to_delayed_action_delay_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
        </span><span class="nl">"basic.to_if_alone_timeout_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
        </span><span class="nl">"basic.to_if_held_down_threshold_milliseconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>反复测试后,以上几个参数设置为上面的值在我的机器表现最佳, 一般alone和held_down的时间设置为相同,delay_action要设置的比其他两个稍大一些.</p>

			</div>
			<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=babyking">comments powered
					by Disqus.</a></noscript>
		</div>
		<div id="footer">
	<p style="color:#ccc;font-size:12px;text-align: center">穿越这无限世界</p>
	<p style="clear:both"></p>
</div>
<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-127077562-1';
    var _gaDomain = '';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>


	</div>
</body>

</html>